# Telegram Verification Bot

Телеграм-бот на `aiogram 2` и `Python 3.10` для полной пошаговой верификации клиента перед покупкой криптовалюты. Управляется с помощью физических кнопок и полностью автоматизирует взаимодействие между клиентом и оператором.

---

## 📲 Функции клиента:

- ✅ Начать верификацию:
  - Принять условия;
  - Ознакомиться с предупреждением о мошенничестве;
  - Загрузить паспорт и селфи;
  - Дождаться проверки оператором.
- 💳 Запросить реквизиты (после верификации);
- 📤 Отправить чек (фото или скрин);
- 🎥 Отправить видео по инструкции;
- ❌ Возможность отмены на любом этапе;
- 📩 Получает уведомления после каждого шага.

---

## 🛠 Функции оператора:

- 👨‍💼 Панель с подсчётом активных заявок (документы, оплаты, видео, реквизиты);
- 📄 Проверка документов (паспорт + селфи);
- 💳 Проверка оплаты (отправленный чек);
- 🎥 Проверка видео (с возможностью подтвердить или отклонить);
- 💬 Выдача реквизитов вручную;
- ⚙️ Управление реквизитами: добавление, редактирование, удаление;
- 🧹 Просмотр всех текущих заявок с возможностью вручную удалить «зависшие»;
- ↩ Кнопка "Назад" на каждом этапе;
- 🔔 Уведомления в операторский чат о действиях клиента.

---

## 🧠 Логика работы:

1. Клиент проходит полную верификацию через FSM.
2. После успешной проверки — может запрашивать реквизиты.
3. У оператора формируется очередь:
   - заявки на проверку документов, оплаты, видео;
   - заявки на выдачу реквизитов.
4. Оператор работает только через кнопки, без команд.
5. Все шаги клиента записываются и проверяются вручную оператором.
6. Верификация автоматически отменяется, если пользователь не завершает процесс в течение часа (отдельный планировщик).

---

## ⚙️ Используемые технологии:

- Python 3.10
- Aiogram 2
- FSM (Finite State Machine)
- SQLite3
- ReplyKeyboard (только физические кнопки)
- Локальное хранение медиа (`user_data/docs`, `user_data/videos`, `user_data/payments`)
- Планировщик на `asyncio` для автоочистки заявок

---

## 📦 Установка

1. Установите зависимости:

```bash
pip install -r requirements.txt
```

2. Создайте `config.py`:

```python
BOT_TOKEN = "ВАШ_ТОКЕН_БОТА"
OPERATORS = [123456789]  # Список ID операторов
GROUP_CHAT_ID = -100123456789  # ID группы для уведомлений
```

3. Инициализируйте базу данных:

```bash
python -c "from database.db import init_db; init_db()"
```

4. Запустите бота:

```bash
python main.py
```

---

## 📁 Структура проекта

```
├── handlers/
│   ├── start.py
│   ├── user_verification.py
│   ├── direct_request.py
│   ├── operator_documents.py
│   ├── operator_payments.py
│   ├── operator_video.py
│   ├── operator_requisites.py
│   └── operator_all_requests.py
├── database/
│   ├── db.py
├── keyboards/
│   ├── reply_common.py
│   ├── reply_user.py
│   └── reply_operator.py
├── states/
│   └── verification.py
├── utils/
│   ├── media_saver.py
│   ├── notifier.py
│   └── role_check.py
├── user_data/
│   ├── docs/
│   ├── videos/
│   └── payments/
├── expired_cleaner.py
├── main.py
├── requirements.txt
└── config.py
```

---

## 🔐 Авторизация

- Роли определяются по `user_id` в списке `OPERATORS`.
- У операторов — доступ к панели, проверкам и реквизитам.
- У пользователей — только FSM-процесс верификации и получение реквизитов после успешного прохождения.

---

## 📝 Лицензия

MIT — свободно используйте, модифицируйте и распространяйте.

---

> Поддержка: Telegram `@kot_teamlead` | Issues — на GitHub
